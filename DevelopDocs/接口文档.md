# 接口文档

## 更新历史

| 更改人         | 变更日期  | 变更原因 |
| -------------- | --------- | ------ |
|许笑晨|2020-10-27|初始化文档|
|陈维烨|2020-10-29|补充文档|
|王阳  |2020-11-3 |整理文档|

## 接口描述

### 1. 获取订单甘特图数据

#### 1.1 url
/order/{date}
#### 1.2 类型
GET
#### 1.3 需求说明
返回{date}所指定日期的订单数据，所谓该日期的订单，指的就是在当天有相应任务进行的那些订单。
#### 1.4 数据
对于links项，只需要传空数组即可
```
{
“ret”: true/false,
“content”:{
“tasks”: {
“data”: [{...}, {...}, {...}, ..., {...}],
“links”: []
},
“delivery_rate”: ...
}
}
```
#### 1.5 Data项数据&说明
* id：数据项id，int类型  
      每个数据项的id必须在当前返回数据中唯一
* number：订单号:，String类型
* text: 任务名称，String类型
	   如果是父任务，任务名称格式为：{A，B，C，...，N}，其中ABCN等是工艺的名称，和各个子任务的任务名称相对应
  	 如果是子任务，任务名称格式为：{A}，其中A是工艺的名称
*	progress：完成度，float类型
	     如果是父任务，则返回的浮点数应当表示整个订单的完成程度，具体如何定义可以由后端决定，可以简单定义为各个工艺完成度的加权平均和，也可以有更复杂精确的定义方式
	     如果是子任务，则返回的浮点数应当表示该子任务代表工艺的完成程度
*	name：产品名称，String类型
	     订单对应的产品名称
*	deal_date：约定交期，String类型
	     订单的约定交期，格式为yyyy-MM-dd，即订单应当被交付的时间
*	expc_date：预计交期，String类型
	     订单的预计交期，格式为yyyy-MM-dd，即订单预计完成的时间
*	parent：父任务id，int类型  
          如果是父任务，不需要该键值对
	      如果是子任务，设置为其父任务的数据项id

#### 1.6 Delivery_rate项数据&说明
* 表示当天的订单交付率，个人理解就是约定交期在这一天的，能有多少按时交付

### 2. 获取产品甘特图数据
### 2.1 按照小时显示
#### 2.1.1 url
/product/{pid}/{date}
#### 2.1.2 类型
GET
#### 2.1.3 需求说明
返回{date}所指定日期中，{pid}产品的排程数据（工艺流程数据）  
* {pid}表示产品在数据库中的id，需要和资源甘特图中的product_id匹配
* {date-str}表示具体的日期，即所请求查看的是某产品哪一日的工艺

#### 2.1.4 数据
```
{
“ret”: true/false,
“content”:{
“product_name”: ...
“tasks”: {
“data”: [{...}, {...}, {...}, ..., {...}],
“links”: [{...}, {...}, {...}, ..., {...}]
}
}
}
```
#### 2.1.5 Product_name项数据&说明
* 表示pid产品的产品名称
#### 2.1.6 Data项数据&说明
*	id：数据项id，int类型，与links项数据相关
	     每个数据项的id必须在当前返回数据的data项中唯一
* resource：资源名称:，String类型
      表示该项工艺所占用的资源的名称
*	start_date：开始时间，String类型，格式为{yyyy-MM-dd hh:mm}
          表示该项工艺的开始时间
*	duration：持续时间，int类型
          以分钟为单位，表示该项工艺任务持续时间

#### 2.1.7 Links项数据&说明
* id：连接项id，int类型
      每个数据项的id必须在当前返回数据的links项中唯一
*	source：头对象id，int类型
	     表示连接起始点所对应的的data项的数据项id
*	target: 尾对象id，int类型
	     表示连接终止点所对应的的data项的数据项id
* Links项数据的意义
      一个订单可能由多个产品组成，每个产品又有可能由多项工艺组合才能完成，而多项工艺又可能有其固定的顺序，例如B工艺必须在A工艺之后进行，此时就需要A工艺连向B工艺的links数据

### 2.2 按照天数显示
#### 2.2.1 url
/product/{pid}
#### 2.2.2 类型
POST
```
POST_DATA（格式均为yyyy-MM-dd）
- {start_date}
- {end_date}
```
#### 2.2.3 需求说明
返回{start_date}到{end_date}中，{pid}产品的排程数据（工艺流程数据）  
{pid}表示产品在数据库中的id，需要和资源甘特图中的product_id匹配

#### 2.2.4 数据
与“按小时显示”部分要求一致

### 3. 获取资源甘特图数据
略

### 4..获取资源使用率数据
###	4.1 按照天数显示
#### 4.1.1 url
/percent
#### 4.1.2 类型
POST
```
POST_DATA（格式均为yyyy-MM-dd）：
- start_date
- end_date
```
#### 4.1.3 需求说明
返回{start_date}到{end_date}期间，资源负载数据

#### 4.1.4 数据
```
{
“ret”: true/false,
“content”:{
“human_percent”: ...,
“device_percent”: ...,
“resource_list”: [{...}, {...}, {...}, ..., {...}],
“table_data”: [{...}, {...}, {...}, ..., {...}]
}
}
```
#### 4.1.5 human_percent&device_percent项数据&说明
* 表示指定时间段内，分别表示人力资源和生产线资源的总负载率  

#### 4.1.6 resource_list项数据&说明
生产线资源在前，人力资源在后
*	id：资源项id，String类型
	     为了防止人力资源id和生产线资源id重复，人力资源的id统一加前缀hr，生产线资源的id统一加前缀ln
	     如果能保证两种资源的id不会存在重复，则可以直接返回后端id
*	name：资源项名称，String类型

#### 4.1.7 table_data项数据&说明
*	date：日期，String类型 —— 格式为"yyyy-MM-dd"
	     表格中日期这一栏的值
*	progress：负载率数组，List<Integer>类型
          数组中每一个值的含义是：在date这一天，资源i的使用率，索引i 所对应的资源就是在资源列表中 位置i 处的资源，这也是为什么在resource_list中强调相应顺序的原因

#### 4.1.8 总负载率计算
* 如果后端不能直接获取，我个人认为就是 实际工作时间/可分配工作时间，例如：
      假如人力每周1-5的8:00-18:00可以工作，那么一周中的可分配工作时间就是10 x 5 = 50h

### 4.2	按照月份显示
#### 4.2.1 url
/product/{pid}
#### 4.2.2 类型
POST
```
POST_DATA（格式均为yyyy-MM）
- {start_date}
- {end_date}
```
#### 4.2.3 需求说明
返回{start_date}到{end_date}中，{pid}产品的排程数据（工艺流程数据）
{pid}表示产品在数据库中的id，需要和资源甘特图中的product_id匹配

#### 4.2.4 数据
table_data部分，date的格式变为”yyyy-MM”，其他要求一致

### 5. 资源信息增删改查
### 5.1	获取资源信息
#### 5.1.1 url
/resourceInfo
#### 5.1.2 类型
GET
#### 5.1.3 需求说明
返回所有资源信息，包括生产线资源和人力资源

#### 5.1.4 数据
```
{
“ret”: true/false,
“content”:{
“human”: [{...}, {...}, {...}, ..., {...}],
“device”: [{...}, {...}, {...}, ..., {...}]
}
}
```
#### 5.1.5 human&device项数据&说明
*	id：资源项id，String类型
	     为了防止人力资源id和生产线资源id重复，人力资源的id统一加前缀hr，生产线资源的id统一加前缀ln
	     如果能保证两种资源的id不会存在重复，则可以直接返回后端id
*	date：资源加入时间，String类型
	     表示该项资源添加的时间，格式为yyyy-MM-dd
	     前端在添加资源时一定会给定，而如果是从excel中读取的可以自行设定
*	name：资源项名称，String类型
*	number：资源数量，int类型

### 5.2	更改资源信息
#### 5.2.1 url
/updateResource
#### 5.2.2 类型
POST
#### 5.2.3 需求说明
返回后端资源更新是否成功，成功与否用ret标识
```
POST_DATA：
id：资源项id，String类型
    与后端返回给前端的id一致
name：资源名称
number：资源数量
```

#### 5.2.4 数据
```
{
“ret”: true/false,
“content”:{}
}
```

### 5.3	添加资源信息
#### 5.3.1 url
/addResource
#### 5.3.2 类型
POST
#### 5.3.3 需求说明
返回后端资源添加是否成功，成功与否用ret标识，同时还有新资源项的资源项id
```
POST_DATA：
date：  资源添加时间，String类型，格式为yyyy-MM-dd
type：  资源类型，int类型，0表示人力资源，1表示生产线资源
name：  资源名称
number：资源数量
```

#### 5.3.4 数据
```
{
“ret”: true/false,
“content”:{
“id”: ...
}
}
```

### 5.4	添加资源信息
#### 5.4.1 url
/deleteResource/{id}
#### 5.4.2 类型
GET
#### 5.4.3 需求说明
返回后端资源删除是否成功，成功与否用ret标识

#### 5.4.4 数据
```
{
“ret”: true/false,
“content”:{}
}
```
